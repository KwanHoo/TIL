# TCP와 UDP

#### 포인트

- MSS : TCP로 전송 가능한 최대 페이로드 크기임
- TCP 세그먼트 : 송신지 포트와 수신지 포트, 순서 번호, 확인 응답 번호, 제어 비트, 윈도우 등의 필드가 있음
  - 순서 번호 : TCP 세그먼트의 순서를 나타내기 위한 정보임
  - 확인 응답 번호 : 수신 호스트가 다음으로 받기를 희망하는 순서 번호임
- TCP :
  - Trasmission Control Protocol
  - 쓰리웨이 핸드 쉐이크로 연결을 수립함
  - CLOSED, ESTABLISHED, LISTEND 등 다양한 상태를 통해 현재 어떤 통신 과정에 있는지를 나타내는 스테이트풀 프로토콜임
- UDP :
  - User Datagram Protocol
  - 비연결형 통신을 수행하는 신뢰할수 없는 프로토콜
  - 스테이트리스 프로토콜의 일종임
- UDP 데이터그램 : 송신지 포트와 수신지 포트, UDP 길이, 체크섬 필드가 있음

### TCP 통신 단계와 세그먼트 구조

TCP 통신 단계

1. 연결 수립
2. 데이터 송수신 : 재전송을 통한 오류 제어, 흐름 제어, 혼잡 제어
3. 연결 종료

- MSS (Maximum Segment Size) : TCP로 전송할 수 있는 최대 페이로드 크기
  TCP 세그먼트 구조
- 송신지 포트, 수신지 포트
- 순서 번호
- 확인 응답 번호
- 제어 비트 ( ACK, SYN, FIN )
- 윈도우

#### 제어비트

- 제어비트 필드는 기본적으로 8 비트로 구성됨

- ACK : 세그먼트의 승인을 나타내기 위한 비트
- SYN : 연결을 수립하기 위한 비트
- FIN : 연결을 종료하기 위한 비트

#### 순서 번호와 확인 응답 번호

- 순서 번호 (sequence number)
  - 세그먼트의 올바른 송수신 순서를 보장하기 위한 번호
- 확인 응답 번호 (ACK number)
  - 순서 번호에 대항 응답임
    - '다음에는 이걸 보내주세요', '다음으로 제가 받을 순서 번호는 이것입니다'
- 순서 번호 필드와 확인 응답 번호 필드는 TCP의 신뢰성을 보장하기 위해 사용되는 중요한 필드
- 한쌍으로 묶어서 기억하는 것이 좋음!

### TCP 연결 수립과 종료

#### 연결 수립 : 쓰리 웨이 핸드셰이크

- 세 단계로 이루어진 TCP의 연결 수립 과정을 의미함
- 액티브 오픈
- 패시브 오픈

#### 연결 종료

- 송수신 호스트가 각자 한 번씩 FIN과 ACK를 주고받으며 이루어짐
  - 네 단계로 연결을 종료한다는 점에서 포 웨이 핸드셰이크라고 부르기도 함
- 액티브 클로즈
- 패시브 클로즈

### TCP 상태

- 상태 : 현재 어떤 통신 과정에 있는지를 나타내는 정보임
- TCP는 상태를 유지하고 활용한다는 점에서 스테이풀 프로토콜이라고도 부름 \
  (1) 연결이 수립되지 않은 상태 \
  (2) 연결 수립 과정에서 주로 볼 수 있는 상태 \
  (3) 연결 종료 과정에서 주로 볼 수 있는 상태

| 상태 분류 | 주요 상태                                                         |
| --------- | ----------------------------------------------------------------- |
| (1)       | CLOSED, LISTEN                                                    |
| (2)       | SYN-SENT, SYN-RECEIVED, ESTABLISHED                               |
| (3)       | FIN-WAIT-1, CLOSED-WAIT, FIN-WAIT-2, LAST-ACK, TIME-WAIT, CLOSING |

- CLOSED : 아무런 연결이 없는 상태
- LISTEND : 일종의 연결 대기 상태
- SYN-SENT : 액티브 오픈 호스트가 SYN 세그먼트를 보낸 뒤 그에 대한 응답인 SYN + ACK 세그먼트를 기다리는 상태
- SYN-RECEIVED : 패시브 오픈 호스트가 SYN + ACK 세그먼트를 보낸 뒤 그에 대한 ACK 세그먼트를 기다리는 상태
- ESTABLISHED : 연결이 확립 되었음을 나타내는 상태
- FIN-WAIT-1 : 연결 종료의 첫단계
- CLOSE-WAIT : FIN 세그먼트를 받은 패시브 클로즈 호스트가 그에 대한 응답으로 ACK 세그먼트를 보낸 후 대기하는 상태
- FIN-WAIT-2 : FIN-WAIT-1 상태에서 ACK 세그먼트를 받게되면 FIN-WAIT-2 상태가 됨. 상대 호스트의 FIN 세그먼트를 기다리는 상태
- LAST-ACK : CLOSE-WAIT 상태에서 FIN 세그먼트를 전송한 뒤 이에 대한 ACK 세그먼트를 기다리는 상태
- TIME-WAIT : 액티브 클로즈 호스트가 FIN 세그먼트를 수신한 뒤, 이에 대한 ACK 세그먼트를 전송한 뒤 접어드느 상태. 일정 시간을 기다린 뒤 CLOSED 상태로 전이함

$netstat : TCP의 다양한 상태 명령어로 확인할 수 있음

### UDP 데이터그램 구조

- UDP : 비연결형 통신을 수행하는 신뢰할 수 없는 프로토콜임

  - 스테이트리스 프로토콜의 일종
  - 총 4가지 필드로 구성 (송신지 포트, 수신지 포트, 길이, 체크섬 필드 )
    - 송신지 포트, 수신지 포트 : 송수신지의 포트 번호가 담김
    - 길이 : 헤더를 포함한 UDP 데이터그램의 바이트가 담김
    - 체크섬 : 데이터그램 전송 과정에서 오류가 발생했는지 검사하기 위한 필드임

- UDP는 TCP에 비해 적은 오버헤드로 패킷을 빠르게 처리 할 수 있음
  - 실시간 스트리밍 서비스, 인터넷 전화처럼 실시간성 강조되는 상황에 쓰임

참고 [혼자 공부하는 네트워크_강민철]
